<div id="title">{{ "study.form.title" | translate }}</div>
<mat-horizontal-stepper [linear]="isLinear" #stepper id="stepper">
  <!--------------------------------------------- Name Step---------------------------------------------------------------------------------->
  <mat-step [stepControl]="nameFormGroup">
    <form [formGroup]="nameFormGroup">
      <ng-template matStepLabel
        >{{ "study.form.name" | translate }}:
      </ng-template>

      <mat-form-field>
        <input
          matInput
          placeholder="{{ 'study.form.namePlaceholder' | translate }}"
          formControlName="name"
          required
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>{{ "next" | translate }}</button>
      </div>
    </form>
  </mat-step>
  <!--------------------------------------------- Description Step---------------------------------------------------------------------------------->

  <mat-step [stepControl]="descriptionFormGroup">
    <form [formGroup]="descriptionFormGroup">
      <ng-template matStepLabel>{{
        "study.form.description" | translate
      }}</ng-template>
      <mat-form-field class="half-width">
        <textarea
          matInput
          formControlName="description"
          placeholder="{{ 'study.form.descriptionPlaceholder' | translate }}"
          matTextareaAutosizet
          matAutosizeMinRows="5"
          matAutosizeMaxRows="50"
        ></textarea>
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>{{ "back" | translate }}</button>
        <button mat-button matStepperNext>{{ "next" | translate }}</button>
      </div>
    </form>
  </mat-step>
  <!--------------------------------------------- Cerco selection (Packages) Step------------------------------------------------------------------->
  <mat-step [stepControl]="targetsFormGroup">
    <form [formGroup]="targetsFormGroup" id="CERCOSelection">
      <ng-template matStepLabel>{{
        "study.form.selectCERCO" | translate
      }}</ng-template>
      <mat-radio-group
        class="radio-group"
        name="runtype"
        formControlName="selectionMode"
        aria-labelledby="targetLabel"
      >
        <label id="targetLabel">{{
          "study.form.targetMode" | translate
        }}</label>

        <mat-radio-button class="radio-button" value="1">
          {{ "study.form.packageSelection" | translate }}
        </mat-radio-button>

        <mat-radio-button class="radio-button" value="2">
          {{ "study.form.packageCreation" | translate }}
        </mat-radio-button>
      </mat-radio-group>

      <mat-form-field *ngIf="targetsFormGroup.value.selectionMode == '1'">
        <mat-label>Paquete</mat-label>
        <mat-select formControlName="package">
          <mat-option
            *ngFor="let package of packages"
            [value]="package.id_paquete"
            matTooltip="{{ package.descripcion }}"
            matTooltipClass="package-description"
            matTooltipPosition="after"
          >
            {{ package.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <button
        *ngIf="targetsFormGroup.value.selectionMode == '2'"
        type="button"
        mat-raised-button
        (click)="fileImportInput.click()"
      >
        Choose File
      </button>

      <mat-form-field *ngIf="targetsFormGroup.value.selectionMode == '2'">
        <input
          matInput
          placeholder="{{ 'study.form.namePackagePlaceholder' | translate }}"
          formControlName="name"
          required
        />
      </mat-form-field>

      <mat-form-field *ngIf="targetsFormGroup.value.selectionMode == '2'">
        <textarea
          matInput
          formControlName="description"
          placeholder="{{
            'study.form.descriptionPackagePlaceholder' | translate
          }}"
          matTextareaAutosize
          matAutosizeMinRows="1"
          matAutosizeMaxRows="50"
        ></textarea>
      </mat-form-field>

      <mat-card
        *ngIf="cercoRecords.length"
        style="width: 70%; margin: 15px auto; background-color: gray"
        ><concentratorPreview [package]="cercoRecords"></concentratorPreview
      ></mat-card>
      <input
        hidden
        formControlName="targets"
        type="file"
        #fileImportInput
        name="File Upload"
        id="txtFileUpload"
        (change)="fileChangeListener($event)"
        accept=".csv"
      />

      <div>
        <button mat-button matStepperPrevious>{{ "back" | translate }}</button>
        <button mat-button matStepperNext>{{ "next" | translate }}</button>
      </div>
    </form>
  </mat-step>

  <!--------------------------------------------- Settings Step------------------------------------------------------------------->

  <mat-step [stepControl]="settingsFormGroup">
    <form [formGroup]="settingsFormGroup">
      <mat-radio-group
        class="radio-group"
        name="runtype"
        formControlName="settingsMode"
        aria-labelledby="executionLabel"
      >
        <label id="executionLabel">{{
          "study.form.executionModeLabel" | translate
        }}</label>

        <mat-radio-button class="radio-button" value="1">
          {{ "study.form.singleRun" | translate }}
        </mat-radio-button>

        <mat-radio-button class="radio-button" value="2">
          {{ "study.form.loop" | translate }}
        </mat-radio-button>
      </mat-radio-group>
      <mat-form-field>
        <input
          matInput
          placeholder="{{ 'study.form.executionNumber' | translate }}"
          formControlName="executionNumber"
          type="number"
          min="2"
          required
      /></mat-form-field>
      <mat-form-field>
        <input
          matInput
          placeholder="{{ 'study.form.loopLengthPlaceholder' | translate }}"
          formControlName="loopLength"
          type="number"
          min="2"
          required
        />
      </mat-form-field>
      <mat-form-field>
        <input
          matInput
          placeholder="{{ 'study.form.attempts' | translate }}"
          type="number"
          min="3"
          class="example-right-align"
          formControlName="attempts"
        />
      </mat-form-field>

      <ng-template matStepLabel>{{
        "study.form.settings" | translate
      }}</ng-template>
      <mat-form-field>
        <mat-label>Priority</mat-label>
        <select matNativeControl required formControlName="priority">
          <option value="3">High</option>
          <option value="2">Medium</option>
          <option value="1">Low</option>
        </select>
      </mat-form-field>

      <div>
        <button mat-button matStepperPrevious>{{ "back" | translate }}</button>
        <button mat-button matStepperNext>{{ "next" | translate }}</button>
      </div>
    </form>
  </mat-step>
  <!--------------------------------------------- Issues Step------------------------------------------------------------------->

  <mat-step [stepControl]="issuesFormGroup">
    <form [formGroup]="issuesFormGroup" style="padding-top:0%">
      <div *ngIf="issuesFormGroup.errors">
        <mat-error *ngIf="issuesFormGroup.errors.atLeastOne">{{
          "study.form.atLeastOne" | translate
        }}</mat-error>
      </div>
      <table
        mat-table
        [dataSource]="dataSource"
        class="mat-elevation-z8"
        style="text-align: left"
      >
        <!-- detect Checkbox Column -->
        <ng-container matColumnDef="detect">
          <th mat-header-cell *matHeaderCellDef>
            DETECT
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              (change)="$event ? detect.toggle(row) : []"
              [checked]="detect.isSelected(row)"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- fix Checkbox Column -->
        <ng-container matColumnDef="fix">
          <th mat-header-cell *matHeaderCellDef>
            FIX
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              (click)="$event.stopPropagation()"
              (change)="$event ? fix.toggle(row) : []"
              [checked]="fix.isSelected(row)"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- id Column -->
        <ng-container matColumnDef="id_incidencia">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let element">
            {{ element.id_incidencia }}
          </td>
        </ng-container>

        <!-- name Column -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>NAME</th>
          <td mat-cell *matCellDef="let element">
            {{ element.nombre }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div>
        <button mat-button matStepperPrevious>{{ "back" | translate }}</button>
        <button mat-button matStepperNext>{{ "next" | translate }}</button>
      </div>
    </form>
    <ng-template matStepLabel>{{
      "study.form.issues" | translate
    }}</ng-template>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>{{ "study.form.done" | translate }}</ng-template>
    You are now done. Resume:
    <div>
      <button mat-button matStepperPrevious>Back</button>
      <button mat-button (click)="stepper.reset()">Reset</button>
      <button mat-button (click)="onSubmit()">Submit</button>
    </div>
  </mat-step>
</mat-horizontal-stepper>

{{ targetsFormGroup.value.selectionMode }}
